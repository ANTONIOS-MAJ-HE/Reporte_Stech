--QUERY DEL REPORTE:

--Listado
SELECT ISNULL(CANAL,'-')  AS CANAL,ISNULL(NUMERO_ORDEN,'-')  AS NUMERO_ORDEN,ISNULL(NUMERO_FACTURA,'-')  AS NUMERO_FACTURA,ISNULL(DNI_CLIENTE,'-')  AS DNI_CLIENTE,ISNULL(NOMBRE_CLIENTE,'-') AS  NOMBRE_CLIENTE, ISNULL(DIRECCION_CLIENTE, '-')  AS DIRECCION_CLIENTE, ISNULL(REGION_VENTA, '-') AS REGION_VENTA, ISNULL(NOMBRE_PRODUCTO, '-') AS NOMBRE_PRODUCTO, ISNULL(MODELO_PRODUCTO, '-') AS MODELO_PRODUCTO, ISNULL(MARCA_PRODUCTO, '-')  AS MARCA_PRODUCTO, ISNULL(CATEGORIA_PRODUCTO, '-') AS CATEGORIA_PRODUCTO, ISNULL(CODIGO_PRODUCTO_CANAL, '-') AS CODIGO_PRODUCTO_CANAL, ISNULL(PART_NUMBER, '-') AS PART_NUMBER, ISNULL(CANTIDAD, 0) AS CANTIDAD, ISNULL(PRECIO_S_IGV, 0) AS PRECIO_S_IGV, ISNULL(PRECIO_C_IGV, 0) AS PRECIO_C_IGV, ISNULL(TOTAL_S_IGV, 0) AS TOTAL_S_IGV, ISNULL(TOTAL_C_IGV, 0) AS TOTAL_C_IGV, ISNULL(FECHA_ORDEN, '2021-01-01') AS FECHA_ORDEN, ISNULL(FECHA_PROCESO, '2021-01-01') AS FECHA_PROCESO,ISNULL(FECHA_DESPACHO, '2021-01-01') AS FECHA_DESPACHO, ISNULL(ST_DESPACHO, '-')  AS ST_DESPACHO, ISNULL(ESTADO_ORDEN, '-') AS ESTADO_ORDEN, ISNULL(OBSERVACION_ORDEN, '-') AS OBSERVACION_ORDEN  FROM ST_CONS_ORDENES_NEW WHERE FECHA_ORDEN >= '2024' ORDER BY FECHA_ORDEN DESC
 

--Filtro

SELECT ISNULL(CANAL,'-')  AS CANAL,ISNULL(NUMERO_ORDEN,'-')  AS NUMERO_ORDEN,ISNULL(NUMERO_FACTURA,'-')  AS NUMERO_FACTURA,ISNULL(DNI_CLIENTE,'-')  AS DNI_CLIENTE,ISNULL(NOMBRE_CLIENTE,'-') AS  NOMBRE_CLIENTE, ISNULL(DIRECCION_CLIENTE, '-')  AS DIRECCION_CLIENTE, ISNULL(REGION_VENTA, '-') AS REGION_VENTA, ISNULL(NOMBRE_PRODUCTO, '-') AS NOMBRE_PRODUCTO, ISNULL(MODELO_PRODUCTO, '-') AS MODELO_PRODUCTO, ISNULL(MARCA_PRODUCTO, '-')  AS MARCA_PRODUCTO, ISNULL(CATEGORIA_PRODUCTO, '-') AS CATEGORIA_PRODUCTO, ISNULL(CODIGO_PRODUCTO_CANAL, '-') AS CODIGO_PRODUCTO_CANAL, ISNULL(PART_NUMBER, '-') AS PART_NUMBER, ISNULL(CANTIDAD, 0) AS CANTIDAD, ISNULL(PRECIO_S_IGV, 0) AS PRECIO_S_IGV, ISNULL(PRECIO_C_IGV, 0) AS PRECIO_C_IGV, ISNULL(TOTAL_S_IGV, 0) AS TOTAL_S_IGV, ISNULL(TOTAL_C_IGV, 0) AS TOTAL_C_IGV, ISNULL(FECHA_ORDEN, '2021-01-01') AS FECHA_ORDEN, ISNULL(FECHA_PROCESO, '2021-01-01') AS FECHA_PROCESO,ISNULL(FECHA_DESPACHO, '2021-01-01') AS FECHA_DESPACHO, ISNULL(ST_DESPACHO, '-')  AS ST_DESPACHO, ISNULL(ESTADO_ORDEN, '-') AS ESTADO_ORDEN, ISNULL(OBSERVACION_ORDEN, '-') AS OBSERVACION_ORDEN  FROM ST_CONS_ORDENES_NEW WHERE NUMERO_ORDEN LIKE '%%' AND NOMBRE_CLIENTE LIKE '%%' AND PART_NUMBER LIKE '%%' AND Convert(varchar,FECHA_PROCESO,23) LIKE '%' AND NOMBRE_PRODUCTO LIKE '%%' AND CANAL LIKE '%Conecta%' ORDER BY FECHA_ORDEN DESC 

--Lista de ventas del mes:

SELECT DIA, TOTAL_SOLES_DIA, TOTAL_UNIDADES_DIA, (SELECT CONVERT(DECIMAL(20,2), SUM(TOTAL_S_IGV)) FROM ST_CONS_ORDENES_NEW WHERE CAST(CONVERT(VARCHAR(10), FECHA_PROCESO, 23) AS DATE) BETWEEN DATEADD(day, -(DAY(GETDATE())) + 1, CAST(GETDATE() AS DATE)) AND CAST(GETDATE() AS DATE)) AS TOTAL_SOLES_MES, (SELECT SUM(CANTIDAD) FROM ST_CONS_ORDENES_NEW WHERE CAST(CONVERT(VARCHAR(10), FECHA_PROCESO, 23) AS DATE) BETWEEN DATEADD(day, -(DAY(GETDATE())) + 1, CAST(GETDATE() AS DATE)) AND CAST(GETDATE() AS DATE)) AS TOTAL_UNIDADES_MES FROM(SELECT CAST(CONVERT(VARCHAR(10), FECHA_PROCESO, 23) AS DATE) AS DIA, CONVERT(DECIMAL(20,2), SUM(TOTAL_S_IGV)) AS TOTAL_SOLES_DIA, SUM(CANTIDAD) AS TOTAL_UNIDADES_DIA FROM ST_CONS_ORDENES_NEW WHERE CAST(CONVERT(VARCHAR(10), FECHA_PROCESO, 23) AS DATE) BETWEEN DATEADD(day, -(DAY(GETDATE())) + 1, CAST(GETDATE() AS DATE)) AND CAST(GETDATE() AS DATE) AND ST_DESPACHO IN (SELECT ST_DESPACHO FROM ST_CONS_ORDENES_NEW WHERE ST_DESPACHO = 'DESPACHODO' OR ST_DESPACHO = 'PENDIENTE' ) GROUP BY CAST(CONVERT(VARCHAR(10), FECHA_PROCESO, 23) AS DATE)) AS Subconsulta ORDER BY DIA DESC

--Lista de ventas por productos

SELECT MARCA_PRODUCTO, ST.MINI_CODIGO AS MINI_CODIGO, PART_NUMBER,STS.STOCK_FINAL AS STOCK_RESTANTE, SUM(CANTIDAD) AS CANTIDAD_PRODUCTOS_VENDIDOS, CONVERT(DECIMAL(20, 2), SUM(TOTAL_S_IGV)) AS SUBTOTAL_S_IGV, CONVERT(DECIMAL(20, 2), SUM(TOTAL_C_IGV)) AS TOTAL_C_IGV, CONVERT(DECIMAL(10, 2), FORMAT(SUM(TOTAL_C_IGV) * 100.0 / SUM(SUM(TOTAL_C_IGV)) OVER(), 'N')) AS PORCENTAJE FROM ST_CONS_ORDENES_NEW CO JOIN ST_STOCK  ST ON ST.PARTNUMBER = CO.PART_NUMBER JOIN ST_STOCK_HST_CONSULTA STS ON STS.PARTNUMBER = CO.PART_NUMBER  WHERE CO.FECHA_PROCESO >= CONVERT(VARCHAR(10), GETDATE(), 120) AND ST_DESPACHO IN (SELECT ST_DESPACHO FROM ST_CONS_ORDENES_NEW WHERE ST_DESPACHO = 'DESPACHODO' OR ST_DESPACHO = 'PENDIENTE' ) GROUP BY MARCA_PRODUCTO, ST.MINI_CODIGO, PART_NUMBER, STS.STOCK_FINAL ORDER BY PORCENTAJE DESC 

--Lista de ventas por canal 

SELECT CANAL,COUNT ( DISTINCT NUMERO_ORDEN) AS [CANTIDAD DE ORDENES], SUM(CANTIDAD) AS [CANTIDAD DE PRODUCTOS], CONVERT(DECIMAL(20, 2),SUM(TOTAL_S_IGV)) AS [PRECIO SIN IGV], CONVERT(DECIMAL(20, 2), SUM(TOTAL_C_IGV)) AS [PRECIO CON IGV], CONVERT(DECIMAL(10, 2), FORMAT(SUM(TOTAL_C_IGV) * 100.0 / SUM(SUM(TOTAL_C_IGV)) OVER(), 'N')) AS PORCENTAJE FROM ST_CONS_ORDENES_NEW WHERE FECHA_PROCESO >= CONVERT(VARCHAR(10), GETDATE(), 120) AND ST_DESPACHO IN (SELECT ST_DESPACHO FROM ST_CONS_ORDENES_NEW WHERE ST_DESPACHO = 'DESPACHODO' OR ST_DESPACHO = 'PENDIENTE' ) GROUP BY CANAL ORDER BY [PRECIO CON IGV] DESC 

--Filtro de ventas por canal por dia

SELECT CANAL, COUNT(DISTINCT NUMERO_ORDEN) AS [CANTIDAD DE ORDENES], SUM(CANTIDAD) AS [CANTIDAD DE PRODUCTOS], CONVERT(DECIMAL(20, 2), SUM(TOTAL_S_IGV)) AS [PRECIO SIN IGV], CONVERT(DECIMAL(20, 2), SUM(TOTAL_C_IGV)) AS [PRECIO CON IGV], CONVERT(DECIMAL(10, 2), FORMAT(SUM(TOTAL_C_IGV) * 100.0 / SUM(SUM(TOTAL_C_IGV)) OVER(), 'N')) AS PORCENTAJE FROM ST_CONS_ORDENES_NEW WHERE CANAL LIKE @canal AND Convert(varchar,FECHA_PROCESO,23) LIKE @fecha AND ST_DESPACHO LIKE @st_despacho AND ST_DESPACHO IN (SELECT ST_DESPACHO FROM ST_CONS_ORDENES_NEW WHERE ST_DESPACHO = 'DESPACHODO' OR ST_DESPACHO = 'PENDIENTE' ) GROUP BY CANAL ORDER BY [PRECIO CON IGV] DESC

--Filtro de ventas por canal por fechas

SELECT CANAL, COUNT(DISTINCT NUMERO_ORDEN) AS [CANTIDAD DE ORDENES], SUM(CANTIDAD) AS [CANTIDAD DE PRODUCTOS], CONVERT(DECIMAL(20, 2), SUM(TOTAL_S_IGV)) AS [PRECIO SIN IGV], CONVERT(DECIMAL(20, 2), SUM(TOTAL_C_IGV)) AS [PRECIO CON IGV], CONVERT(DECIMAL(10, 2), FORMAT(SUM(TOTAL_C_IGV) * 100.0 / SUM(SUM(TOTAL_C_IGV)) OVER(), 'N')) AS PORCENTAJE FROM ST_CONS_ORDENES_NEW WHERE CANAL LIKE @canal AND FECHA_PROCESO BETWEEN @FechaInicio AND @FechaFin AND ST_DESPACHO LIKE @st_despacho AND ST_DESPACHO IN (SELECT ST_DESPACHO FROM ST_CONS_ORDENES_NEW WHERE ST_DESPACHO = 'DESPACHODO' OR ST_DESPACHO = 'PENDIENTE' ) GROUP BY CANAL ORDER BY [PRECIO CON IGV] DESC


--Filtro de ventas de productos por dia

SELECT MARCA_PRODUCTO, ST.MINI_CODIGO AS MINI_CODIGO, PART_NUMBER,STS.STOCK_FINAL AS STOCK_RESTANTE, SUM(CANTIDAD) AS CANTIDAD_PRODUCTOS_VENDIDOS, CONVERT(DECIMAL(20, 2), SUM(TOTAL_S_IGV)) AS SUBTOTAL_S_IGV,  CONVERT(DECIMAL(20, 2), SUM(TOTAL_C_IGV)) AS TOTAL_C_IGV, CONVERT(DECIMAL(10, 2), FORMAT(SUM(TOTAL_C_IGV) * 100.0 / SUM(SUM(TOTAL_C_IGV)) OVER(), 'N')) AS PORCENTAJE FROM ST_CONS_ORDENES_NEW CO JOIN ST_STOCK  ST ON ST.PARTNUMBER = CO.PART_NUMBER JOIN ST_STOCK_HST_CONSULTA STS ON STS.PARTNUMBER = CO.PART_NUMBER  WHERE CO.CANAL LIKE @canal AND Convert(varchar,CO.FECHA_PROCESO,23) LIKE @fecha AND CO.ST_DESPACHO LIKE @st_despacho AND ST_DESPACHO IN (SELECT ST_DESPACHO FROM ST_CONS_ORDENES_NEW WHERE ST_DESPACHO = 'DESPACHODO' OR ST_DESPACHO = 'PENDIENTE' ) GROUP BY MARCA_PRODUCTO, ST.MINI_CODIGO, PART_NUMBER, STS.STOCK_FINAL  ORDER BY PORCENTAJE DESC

--Filtro de ventas de productos por fechas

SELECT MARCA_PRODUCTO, ST.MINI_CODIGO AS MINI_CODIGO, PART_NUMBER,STS.STOCK_FINAL AS STOCK_RESTANTE, SUM(CANTIDAD) AS CANTIDAD_PRODUCTOS_VENDIDOS, CONVERT(DECIMAL(20, 2), SUM(TOTAL_S_IGV)) AS SUBTOTAL_S_IGV,  CONVERT(DECIMAL(20, 2), SUM(TOTAL_C_IGV)) AS TOTAL_C_IGV, CONVERT(DECIMAL(10, 2), FORMAT(SUM(TOTAL_C_IGV) * 100.0 / SUM(SUM(TOTAL_C_IGV)) OVER(), 'N')) AS PORCENTAJE FROM ST_CONS_ORDENES_NEW CO JOIN ST_STOCK  ST ON ST.PARTNUMBER = CO.PART_NUMBER JOIN ST_STOCK_HST_CONSULTA STS ON STS.PARTNUMBER = CO.PART_NUMBER  WHERE CO.CANAL LIKE @canal AND CO.FECHA_PROCESO BETWEEN @FechaInicio AND @FechaFin AND ST_DESPACHO IN (SELECT ST_DESPACHO FROM ST_CONS_ORDENES_NEW WHERE ST_DESPACHO = 'DESPACHODO' OR ST_DESPACHO = 'PENDIENTE' ) AND CO.ST_DESPACHO LIKE @st_despacho GROUP BY MARCA_PRODUCTO, ST.MINI_CODIGO, PART_NUMBER, STS.STOCK_FINAL ORDER BY PORCENTAJE DESC


